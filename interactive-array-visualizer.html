<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refined Dark Mode Custom Color Interactive Array Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        #array-container {
            width: 100%;
            max-width: 100%;
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            overflow: auto;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
        }

        .control-section {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .section-title {
            width: 100%;
            font-weight: bold;
            margin-bottom: 5px;
            color: #b0b0b0;
        }

        button, input {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button:hover {
            background-color: #45a049;
        }

        input[type="text"], input[type="number"] {
            background-color: #3a3a3a;
            color: #e0e0e0;
            border: 1px solid #5a5a5a;
        }

        input[type="color"] {
            width: 50px;
            height: 30px;
            padding: 0;
            border: none;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 5px;
            width: 100%;
            max-width: 200px;
        }

        .color-picker label {
            font-size: 14px;
            min-width: 70px;
            text-align: right;
            margin-right: 5px;
        }

        #show-indexes, #transparent-background {
            margin-right: 10px;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-size-control label {
            min-width: 120px;
        }

        .checkbox-control {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .checkbox-control input[type="checkbox"] {
            margin: 0;
        }

        .checkbox-control label {
            margin-left: 0;
        }
    </style>
</head>
<body>
<div id="array-container">
    <svg></svg>
</div>
<div class="controls">
    <div class="control-section">
        <div class="section-title">Array Input</div>
        <label for="array-input"></label><input type="text" id="array-input"
                                                placeholder="Enter array (comma-separated)">
        <button onclick="updateArray()">Update Array</button>
    </div>
    <div class="control-section">
        <div class="section-title">Array Operations</div>
        <label for="split-index"></label><input type="number" id="split-index" placeholder="Split index" min="0">
        <button onclick="splitArray()">Split Array</button>
        <button onclick="resetArray()">Reset</button>
    </div>
    <div class="control-section">
        <div class="section-title">Color Settings</div>
        <div class="color-picker">
            <label for="base-color">Base:</label>
            <input type="color" id="base-color" value="#E3F9F9" onchange="updateColors()">
        </div>
        <div class="color-picker">
            <label for="highlight-color">Highlight:</label>
            <input type="color" id="highlight-color" value="#1AD1B2" onchange="updateColors()">
        </div>
        <div class="color-picker">
            <label for="split1-color">Split 1:</label>
            <input type="color" id="split1-color" value="#1AD1B2" onchange="updateColors()">
        </div>
        <div class="color-picker">
            <label for="split2-color">Split 2:</label>
            <input type="color" id="split2-color" value="#91C0BF" onchange="updateColors()">
        </div>
    </div>
    <div class="control-section">
        <div class="section-title">Font Settings</div>
        <div class="font-size-control">
            <label for="element-font-size">Element Font Size:</label>
            <input type="number" id="element-font-size" value="30" min="20" max="50" onchange="changeFontSize()">
        </div>
        <div class="font-size-control">
            <label for="index-font-size">Index Font Size:</label>
            <input type="number" id="index-font-size" value="17" min="10" max="20" onchange="changeFontSize()">
        </div>
        <div class="color-picker">
            <label for="element-font-color">Element Font Color:</label>
            <input type="color" id="element-font-color" value="#1a1a1a" onchange="updateFontColors()">
        </div>
        <div class="color-picker">
            <label for="index-font-color">Index Font Color:</label>
            <input type="color" id="index-font-color" value="#e0e0e0" onchange="updateFontColors()">
        </div>
        <div class="checkbox-control">
            <input type="checkbox" id="show-indexes" checked onchange="drawArray()">
            <label for="show-indexes">Show Indexes</label>
        </div>
    </div>
    <div class="control-section">
        <div class="section-title">Export</div>
        <div class="color-picker">
            <label for="background-color">Background Color:</label>
            <input type="color" id="background-color" value="#2a2a2a">
        </div>
        <div class="checkbox-control">
            <input type="checkbox" id="transparent-background">
            <label for="transparent-background">Transparent Background</label>
        </div>
        <button onclick="downloadImage()">Download Image</button>
    </div>
</div>

<script>
    const defaultColors = {
        base: "#E3F9F9",
        highlight: "#1AD1B2",
        split1: "#1AD1B2",
        split2: "#91C0BF"
    };

    const defaultFontSizes = {
        element: 30,
        index: 17
    };

    const defaultFontColors = {
        element: "#1a1a1a",
        index: "#e0e0e0"
    };

    const ELEMENT_SIZE = 80;
    const ELEMENT_MARGIN = 2;
    const INDEX_HEIGHT = 35;
    const margin = {top: 20, right: 20, bottom: 20, left: 20};

    let arr = [1, 1, 1, 2, 3, 4];

    const svg = d3.select("svg");

    let colors = {...defaultColors};
    let fontColors = {...defaultFontColors};

    function updateSVGSize() {
        const showIndexes = document.getElementById("show-indexes").checked;
        const totalWidth = arr.length * (ELEMENT_SIZE + ELEMENT_MARGIN) - ELEMENT_MARGIN + margin.left + margin.right;
        const totalHeight = ELEMENT_SIZE + (showIndexes ? INDEX_HEIGHT : 0) + margin.top + margin.bottom;

        d3.select("#array-container")
            .style("width", `${totalWidth}px`);

        svg.attr("width", totalWidth)
            .attr("height", totalHeight);

        return {totalWidth, totalHeight};
    }

    function drawArray() {
        svg.selectAll("*").remove();

        updateSVGSize();
        const showIndexes = document.getElementById("show-indexes").checked;

        const elements = svg.append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`)
            .selectAll("g")
            .data(arr)
            .enter()
            .append("g")
            .attr("transform", (d, i) => `translate(${i * (ELEMENT_SIZE + ELEMENT_MARGIN)}, 0)`);

        elements.append("rect")
            .attr("class", "array-element")
            .attr("width", ELEMENT_SIZE)
            .attr("height", ELEMENT_SIZE)
            .attr("fill", colors.base)
            .on("click", function () {
                const currentColor = d3.select(this).attr("fill");
                d3.select(this).attr("fill",
                    currentColor === colors.highlight ? colors.base : colors.highlight
                );
            });

        elements.append("text")
            .attr("class", "array-text")
            .attr("x", ELEMENT_SIZE / 2)
            .attr("y", ELEMENT_SIZE / 2 + 4)
            .attr("text-anchor", "middle")
            .attr("dominant-baseline", "middle")
            .text(d => d)
            .attr("fill", fontColors.element);

        if (showIndexes) {
            elements.append("text")
                .attr("class", "index-text")
                .attr("x", ELEMENT_SIZE / 2)
                .attr("y", ELEMENT_SIZE + INDEX_HEIGHT / 2)
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .text((d, i) => i)
                .attr("fill", fontColors.index);
        }

        changeFontSize();
    }

    function updateArray() {
        const input = document.getElementById("array-input").value;
        arr = input.split(",").map(item => parseInt(item.trim()));
        drawArray();
    }

    function splitArray() {
        const splitIndex = parseInt(document.getElementById("split-index").value);
        if (isNaN(splitIndex) || splitIndex < 0 || splitIndex >= arr.length) {
            alert("Please enter a valid split index");
            return;
        }
        svg.selectAll("rect")
            .attr("fill", (d, i) => i < splitIndex ? colors.split1 : colors.split2);
    }

    function resetArray() {
        colors = {...defaultColors};
        document.getElementById("base-color").value = colors.base;
        document.getElementById("highlight-color").value = colors.highlight;
        document.getElementById("split1-color").value = colors.split1;
        document.getElementById("split2-color").value = colors.split2;

        document.getElementById("element-font-size").value = defaultFontSizes.element;
        document.getElementById("index-font-size").value = defaultFontSizes.index;

        fontColors = {...defaultFontColors};
        document.getElementById("element-font-color").value = fontColors.element;
        document.getElementById("index-font-color").value = fontColors.index;

        drawArray();
    }

    function updateColors() {
        colors.base = document.getElementById("base-color").value;
        colors.highlight = document.getElementById("highlight-color").value;
        colors.split1 = document.getElementById("split1-color").value;
        colors.split2 = document.getElementById("split2-color").value;
        svg.selectAll("rect")
            .attr("fill", colors.base);
    }

    function updateFontColors() {
        fontColors.element = document.getElementById("element-font-color").value;
        fontColors.index = document.getElementById("index-font-color").value;
        svg.selectAll(".array-text")
            .attr("fill", fontColors.element);
        svg.selectAll(".index-text")
            .attr("fill", fontColors.index);
    }

    function changeFontSize() {
        const elementFontSize = document.getElementById("element-font-size").value;
        const indexFontSize = document.getElementById("index-font-size").value;
        svg.selectAll(".array-text")
            .style("font-size", `${elementFontSize}px`);
        svg.selectAll(".index-text")
            .style("font-size", `${indexFontSize}px`);
    }

    function downloadImage() {
        const svgNode = svg.node();
        const svgWidth = svgNode.width.baseVal.value;
        const svgHeight = svgNode.height.baseVal.value;

        const canvas = document.createElement("canvas");
        canvas.width = svgWidth;
        canvas.height = svgHeight;
        const ctx = canvas.getContext("2d");

        const transparentBackground = document.getElementById("transparent-background").checked;
        if (!transparentBackground) {
            ctx.fillStyle = document.getElementById("background-color").value;
            ctx.fillRect(0, 0, svgWidth, svgHeight);
        }

        const img = new Image();
        const svgData = new XMLSerializer().serializeToString(svgNode);
        const svgBlob = new Blob([svgData], {type: "image/svg+xml;charset=utf-8"});
        const url = URL.createObjectURL(svgBlob);

        img.onload = function () {
            ctx.drawImage(img, 0, 0);
            URL.revokeObjectURL(url);

            const pngUrl = canvas.toDataURL("image/png");
            const downloadLink = document.createElement("a");
            downloadLink.href = pngUrl;
            downloadLink.download = "array_visualization.png";
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        };
        img.src = url;
    }

    drawArray();
</script>
</body>
</html>